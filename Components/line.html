<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>入口首頁</title>
    <!-- 載入Vue框架 -->
    <script src="https://unpkg.com/vue@2.6.14/dist/vue.js"></script>
    <!-- 引用Bootstrap CSS Style -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"
      crossorigin="anonymous"
    />
    <style></style>
  </head>

  <body>
    <div id="app">
      <button @click="clickLogin">登入</button>
      <button @click="clickInfo">測試</button>
    </div>
  </body>
  <!-- 引用Boostrap Script -->
  <script
    src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"
    integrity="sha384-eMNCOe7tC1doHpGoWe/6oMVemdAVTMs2xqW4mwXrXsW0L84Iytr2wi5v2QjrP/xp"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.min.js"
    integrity="sha384-cn7l7gDp0eyniUwwAZgrzD06kc/tftFf19TOAs2zVinnD/C7E91j9yyk5//jjpt/"
    crossorigin="anonymous"
  ></script>
  <!-- 引用axios -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    var app = new Vue({
      //載入位置
      el: "#app",
      //資料
      data: {
        parameter: {
          grant_type: "authorization_code", //固定
          code: "CODE",
          redirect_uri: "https://taihochan.github.io/Components/line.html",
          client_id: "1656635140",
          client_secret: "ac4ad18b48a5f0ee9886adf89519ac32"
        }
      },
      //方法
      methods: {
        clickLogin() {
          let url = "https://access.line.me/oauth2/v2.1/authorize"; //固定
          let clienId = "1656635140";
          let redirectUri = "https://taihochan.github.io/Components/line.html";
          let scope = "profile%20openid";
          url += "?response_type=code"; //固定
          url += "&client_id=" + clienId;
          url += "&redirect_uri=" + redirectUri;
          url += "&state=login"; //固定
          url += "&scope=" + scope;
          window.location.href = url;
        },
        clickInfo() {
          let temp = location.search;
          let code = temp.substring(temp.indexOf("=") + 1, temp.indexOf("&"));
          this.parameter.code = code;
          this.getInfo();
        },
        getInfo() {
          axios({
            method: "post",
            url: `https://api.line.me/oauth2/v2.1/token`,
            headers: {
              "Content-Type": "application/x-www-form-urlencoded"
            },
            params: this.parameter
          })
            .then((res) => {
              console.log(res);
              alert("登錄成功");
            })
            .catch((err) => {})
            .finally(() => {});
        }
      },
      //運算
      computed: {}
    });
  </script>
</html>
